//When Office 365 detects malware in OneDrive or SharePoint find any users that downloaded the same file

//Data connector required for this query - Office 365

let malware=
    OfficeActivity
    | where TimeGenerated > ago(1d)
    | where Operation == "FileMalwareDetected"
    | distinct OfficeObjectId;
OfficeActivity
| where TimeGenerated > ago (1d)
| where Operation in ("FileSyncDownloadedFull", "FileDownloaded")
| where OfficeObjectId in (malware)
| summarize ['Users who Downloaded']=make_set(UserId) by ['File Name']=OfficeObjectId