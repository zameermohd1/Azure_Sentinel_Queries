//When Defender for Endpoint detects malware in an ISO file retrieve the ISO file name, which directory it was found in and associated file hashes

//Data connector required for this query - Security Alert (free table that other Defender products send alert info to)

SecurityAlert
| where ProviderName == "MDATP"
| where AlertName == "Malware was detected in an iso disc image file"
| mv-expand todynamic(Entities)
| extend Hashes = Entities.FileHashes
| mv-expand Hashes
| extend ['ISO File Name'] = tostring(Entities.Name)
| extend Directory = tostring(Entities.Directory)
| extend ['Hash Type'] = tostring(Hashes.Algorithm)
| extend Hash = tostring(Hashes.Value)
| where isnotempty(['ISO File Name'])
| project
    TimeGenerated,
    CompromisedEntity,
    ['ISO File Name'],
    Directory,
    ['Hash Type'],
    Hash